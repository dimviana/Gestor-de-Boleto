-- Database: boleto_manager_ai
-- This schema defines the structure for the Boleto Manager AI application,
-- including multi-company support and remote update features.

--
-- Table structure for table `companies`
--
CREATE TABLE IF NOT EXISTS `companies` (
  `id` VARCHAR(36) NOT NULL COMMENT 'UUID for the company',
  `name` VARCHAR(255) NOT NULL,
  `cnpj` VARCHAR(20) DEFAULT NULL,
  `address` VARCHAR(255) DEFAULT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

--
-- Table structure for table `users`
--
CREATE TABLE IF NOT EXISTS `users` (
  `id` VARCHAR(36) NOT NULL COMMENT 'UUID for the user',
  `username` VARCHAR(255) NOT NULL COMMENT 'User''s email address, used for login',
  `password` VARCHAR(255) NOT NULL COMMENT 'Hashed password for security',
  `role` ENUM('user', 'admin') NOT NULL DEFAULT 'user' COMMENT 'User role for authorization',
  `company_id` VARCHAR(36) DEFAULT NULL COMMENT 'Foreign key linking to the company',
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `username_UNIQUE` (`username`),
  KEY `company_id_fk_idx` (`company_id`),
  CONSTRAINT `users_company_id_fk` FOREIGN KEY (`company_id`) REFERENCES `companies` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

--
-- Table structure for table `boletos`
--
CREATE TABLE IF NOT EXISTS `boletos` (
  `id` VARCHAR(36) NOT NULL COMMENT 'UUID for the boleto',
  `user_id` VARCHAR(36) NOT NULL COMMENT 'Foreign key linking to the user who uploaded it',
  `company_id` VARCHAR(36) NOT NULL COMMENT 'Foreign key linking to the company',
  `recipient` VARCHAR(255) DEFAULT NULL,
  `drawee` VARCHAR(255) DEFAULT NULL,
  `document_date` DATE DEFAULT NULL,
  `due_date` DATE DEFAULT NULL,
  `amount` DECIMAL(10,2) DEFAULT NULL,
  `discount` DECIMAL(10,2) DEFAULT NULL,
  `interest_and_fines` DECIMAL(10,2) DEFAULT NULL,
  `barcode` VARCHAR(255) DEFAULT NULL,
  `guide_number` VARCHAR(255) DEFAULT NULL,
  `pix_qr_code_text` TEXT DEFAULT NULL,
  `status` ENUM('PAGAR', 'VERIFICAR', 'PAGO') NOT NULL DEFAULT 'PAGAR',
  `file_name` VARCHAR(255) NOT NULL,
  `file_data` MEDIUMTEXT NOT NULL COMMENT 'Base64 encoded PDF data',
  `comments` TEXT DEFAULT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `user_id_fk_idx` (`user_id`),
  KEY `company_id_fk_idx` (`company_id`),
  KEY `barcode_idx` (`barcode`),
  CONSTRAINT `boletos_user_id_fk` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE,
  CONSTRAINT `boletos_company_id_fk` FOREIGN KEY (`company_id`) REFERENCES `companies` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

--
-- Table structure for table `activity_logs`
--
CREATE TABLE IF NOT EXISTS `activity_logs` (
  `id` VARCHAR(36) NOT NULL COMMENT 'UUID for the log entry',
  `user_id` VARCHAR(36) NOT NULL,
  `username` VARCHAR(255) NOT NULL,
  `action` VARCHAR(50) NOT NULL,
  `details` TEXT,
  `timestamp` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `user_id_idx` (`user_id`),
  KEY `action_idx` (`action`),
  KEY `timestamp_idx` (`timestamp`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

--
-- Table structure for table `settings`
--
CREATE TABLE IF NOT EXISTS `settings` (
  `id` INT AUTO_INCREMENT,
  `setting_key` VARCHAR(255) NOT NULL,
  `setting_value` TEXT,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `setting_key_UNIQUE` (`setting_key`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

--
-- Initial data for `settings` table
--
INSERT INTO `settings` (`setting_key`, `setting_value`) VALUES
('whitelabel_appName', 'Boleto Manager AI'),
('whitelabel_logoUrl', ''),
('processing_method', 'ai'),
('ai_settings', '{"model": "gemini-2.5-flash", "temperature": 0.2, "topK": 1, "topP": 1}'),
('API_KEY', ''),
('JWT_SECRET', '')
ON DUPLICATE KEY UPDATE `setting_value` = VALUES(`setting_value`);